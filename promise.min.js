/*! jstool-promise 2015-02-11 */
!function(a){"undefined"==typeof window?"undefined"!=typeof module&&(module.exports=a()):window.fn?fn.define("qPromise",a):window.qPromise||(window.qPromise=a())}(function(){function a(a,b){b instanceof Function&&setTimeout(function(){b.apply(a,[function(b){a.resolve(b)},function(b){a.reject(b)}])},0)}function b(a,b){for(var c=a.shift();a.length&&!c[b];)c=a.shift();return c}function c(a,c,d,e){var f=b(a.queue,d);if(f?(a["[[PromiseStatus]]"]=c,void 0!==e&&(a["[[PromiseValue]]"]=e)):(f=b(a.queue.finally,d),e=a["[[PromiseValue]]"]),f&&f[d]){try{var g=f[d].call(a,e)}catch(h){a["[[PromiseStatus]]"]="rejected",a["[[PromiseValue]]"]=h,e=h}if(g&&g.then instanceof Function)g.then(function(b){return a.resolve(b),b},function(b){throw a.reject(b),b});else switch(a["[[PromiseStatus]]"]){case"fulfilled":a.resolve(void 0===g?e:g);break;case"rejected":a.reject(void 0===g?e:g)}}return a}function d(b){return void 0===this||this===window?new d(b):(this.queue=[],this.queue.finally=[],this["[[PromiseStatus]]"]="pending",this["[[PromiseValue]]"]=void 0,void a(this,b))}return d.prototype.then=function(a,b){return a instanceof Function&&this.queue.push({then:a,"catch":b}),this},d.prototype.catch=function(a){return a instanceof Function&&this.queue.push({"catch":a}),this},d.prototype.finally=function(a,b){return a instanceof Function&&this.queue.finally.push({then:a,"catch":b}),this},d.prototype.resolve=function(a){return c(this,"fulfilled","then",a)},d.prototype.reject=function(a){return c(this,"rejected","catch",a)},d.defer=function(){var a=new d;return a.promise=a,a},d.when=function(a){var b=new d(function(c,d){a&&a.then?a.then(c,d):c(b,a)});return b},d});