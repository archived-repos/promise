/*! jengine-promise 2015-06-03 */
!function(a,b){if("undefined"!=typeof module)module.exports=b(a);else if(a.define)a.define("$promise",function(){return b(a)});else if(a.angular){var c=b(a);a.angular.module("jstools.promise",[]).provider("$promise",function(){this.config=function(a){a.call(null,c)},this.$get=function(){return c}})}else a.$promise||(a.$promise=b(a))}(this,function(a){function b(a,b){b instanceof Function&&setTimeout(function(){b.apply(a,[function(b){a.resolve(b)},function(b){a.reject(b)}])},0)}function c(a,b){for(var c=a.shift();a.length;){if(c[b])return c;c=a.shift()}return c&&c[b]?c:!1}function d(a,b,d){var e=g[b],f=c(a.queue,e);if(f)a["[[PromiseStatus]]"]=b,void 0!==d&&(a["[[PromiseValue]]"]=d);else{for(f=a.queue["finally"].shift();f;)f(d),f=a.queue["finally"].shift();f=!1}if(f&&f[e]){try{var h=f[e].call(a,d);a["[[PromiseStatus]]"]="fulfilled"}catch(i){a["[[PromiseStatus]]"]="rejected",a["[[PromiseValue]]"]=i,h=i}if(h&&h.then instanceof Function)h.then(function(b){return a.resolve(b),b},function(b){throw a.reject(b),b});else switch(a["[[PromiseStatus]]"]){case"fulfilled":a.resolve(void 0===h?d:h);break;case"rejected":a.reject(void 0===h?d:h)}}return a}function e(a,c){a.queue=[],a.queue["finally"]=[],a["[[PromiseStatus]]"]="pending",a["[[PromiseValue]]"]=void 0,b(a,c)}function f(b){return void 0===this||this===a?new f(b):void e(this,b)}var g={fulfilled:"then",rejected:"catch"};return f.prototype.then=function(a,b){return this.queue.push({then:a instanceof Function?a:!1,"catch":b instanceof Function?b:!1}),this},f.prototype["catch"]=function(a){return this.then(void 0,a),this},f.prototype["finally"]=function(a){return a instanceof Function&&this.queue["finally"].push(a),this},f.prototype.resolve=function(a){return d(this,"fulfilled",a)},f.prototype.reject=function(a){return d(this,"rejected",a)},f.resolve=function(a){return f(function(b,c){b(a)})},f.reject=function(a){return f(function(b,c){c(a)})},f.defer=function(){var a=new f;return a.promise=a,a},f.when=function(a){return f(function(b,c){a&&a.then?a.then(b,c):b(a)})},f.all=function(a){a=a instanceof Array?a:[];var b=a.length,c=[];return c.length=a.length,new f(function(d,e){return b?void a.forEach(function(a,f){a instanceof Object&&a.then?"fulfilled"===a["[[PromiseStatus]]"]?(c[f]=a["[[PromiseValue]]"],b--,b||d(c)):"reject"===a["[[PromiseStatus]]"]?e(a["[[PromiseValue]]"]):a.then(function(a){c[f]=a,b--,b||d(c)},e):(c[f]=a,b--,b||d(c))}):void d([])})},f});